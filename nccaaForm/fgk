<!DOCTYPE html>
<html lang="ne">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NCCAA Lumbini Cadet System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+Devanagari:wght@400;700&display=swap');

        body {
            font-family: 'Noto Serif Devanagari', serif;
            background: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100%;
            /* make the full-screen loader white as requested */
            background: #ffffff;
            color: #111827;
            z-index: 9999;
            position: fixed;
            top: 0;
            left: 0;
            transition: opacity 1s ease-out;
        }

        .loading-card {
            background: #ffffff;
            border-radius: 14px;
            /* stronger subtle shadow for a professional look */
            box-shadow: 0 12px 30px rgba(16, 24, 40, 0.12);
            padding: 2.25rem 2rem;
            text-align: center;
            /* slightly wider but not too wide */
            max-width: 380px;
            width: 86%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
            transform-origin: center;
            animation: popIn 360ms cubic-bezier(.2, .9, .2, 1);
        }

        .logo-container {
            width: 170px;
            height: 170px;
            margin-bottom: 0.25rem;
            border-radius: 50%;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* outer ring to mimic the embossed circular badge in your screenshot */
        .logo-container::before {
            content: '';
            position: absolute;
            inset: 0;
            margin: auto;
            width: 152px;
            height: 152px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 6px 20px rgba(17, 24, 39, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.7);
            border: 6px solid #f3f4f6;
            z-index: 0;
        }

        .logo-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            border-radius: 50%;
            background: transparent;
            padding: 6px;
            position: relative;
            z-index: 1;
        }

        .org-name {
            font-size: 1.15rem;
            font-weight: 700;
            color: #0f172a;
            margin: 6px 0 0 0;
            line-height: 1.35;
            letter-spacing: 0.2px;
        }

        .org-subtitle {
            font-size: 0.82rem;
            color: #64748b;
            margin: 0.25rem 0 0.6rem 0;
            font-weight: 500;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 1rem 0;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 0;
            overflow: auto;
        }

        .modal-content {
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 21cm;
            /* A4 width */
            min-height: 29.7cm;
            /* A4 height */
            padding: 2.5cm 2.5cm 2cm;
            /* Standard letter margins */
            position: relative;
            color: #1f2937;
            margin: 0 auto;
            box-sizing: border-box;
            font-size: 14px;
            line-height: 1.6;
            transform-origin: top center;
            transform: scale(0.85);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
            padding: 1rem;
        }

        .modal-container {
            padding: 2rem 0;
            margin: auto;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* Large screens */
        @media screen and (min-height: 900px) {
            .modal-content {
                transform: scale(0.9);
            }
        }

        /* Medium screens */
        @media screen and (max-height: 900px) {
            .modal-content {
                transform: scale(0.8);
                margin: 0;
                padding: 0.8in 0.8in 0.8in;
            }
        }

        /* Smaller screens */
        @media screen and (max-height: 800px) {
            .modal-content {
                transform: scale(0.7);
                margin: 0;
                padding: 0.8in 0.8in 0.8in;
            }
        }

        /* Mobile devices in portrait */
        @media screen and (max-width: 480px) {
            .modal-content {
                transform: scale(0.55);
                padding: 0.8in 0.6in 0.6in;
                margin: 0;
            }
        }

        /* Handle different zoom levels */
        @media screen and (max-width: 1024px) and (max-height: 768px) {
            .modal-content {
                transform: scale(0.6);
                margin: 0;
                padding: 0.8in 0.8in 0.8in;
            }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.2s;
            z-index: 100;
            background: white;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal-close:hover {
            color: #111827;
        }

        .notice-header {
            text-align: center;
            margin-bottom: 1rem;
        }

        .notice-header h1 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .notice-body {
            margin: 1.5rem 0;
            line-height: 1.6;
            text-align: justify;
        }

        .notice-list {
            margin: 1rem 0 1.5rem 0;
            padding-left: 1rem;
        }

        .notice-list li {
            margin: 0.5rem 0;
        }

        .btn-primary {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: #4f46e5;
            color: white;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .form-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            position: relative;
        }

        .welcome-message {
            font-size: 0.86rem;
            color: #475569;
            margin: 0.25rem 0 0.6rem 0;
            line-height: 1.5;
            max-width: 260px;
        }

        /* refined spinner for the card */
        .card-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid rgba(124, 58, 237, 0.18);
            border-top: 3px solid rgba(124, 58, 237, 1);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 10px;
            background: transparent;
        }

        @keyframes popIn {
            0% {
                transform: translateY(6px) scale(.985);
                opacity: 0
            }

            60% {
                transform: translateY(0) scale(1.01);
                opacity: 1
            }

            100% {
                transform: translateY(0) scale(1);
            }
        }

        .loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
            transition: opacity 600ms ease;
        }

        .form-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }

        .form-field {
            margin-bottom: 1rem;
        }

        .form-field label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .form-field input,
        .form-field select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-field input:focus,
        .form-field select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-submit {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: #166534;
            color: white;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 1.5rem;
        }

        .form-submit:hover {
            background: #155e75;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media screen and (max-width: 1280px) {
            .modal-content {
                transform: scale(0.75);
            }
        }

        @media screen and (max-width: 1024px) {
            .modal-content {
                transform: scale(0.65);
            }
        }

        @media screen and (max-width: 768px) {
            .modal-content {
                transform: scale(0.55);
            }
        }

        @media screen and (max-width: 480px) {
            .modal-content {
                transform: scale(0.45);
                padding: 1.5cm 1.5cm 1.5cm;
            }
        }

        /* Success Modal */
        .success-modal {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 400px;
            width: 100%;
            padding: 2rem;
            text-align: center;
        }

        .success-icon {
            font-size: 3rem;
            color: #10b981;
            margin-bottom: 1rem;
        }

        .success-text {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }

        .success-btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #10b981;
            color: white;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .success-btn:hover {
            background: #059669;
        }
    </style>
</head>

<body>

    <!-- LOADING SCREEN -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-card">
            <div class="logo-container">
                <img src="assets/photos/logo.png" alt="NCCAA Lumbini logo" class="logo-image" />
            </div>
            <h1 class="org-name">NCCAA Lumbini Cadet System</h1>
            <p class="org-subtitle">सुरक्षित क्याडेट दर्ता प्रणाली</p>
            <p class="welcome-message">Welcome / स्वागत छ — सुरक्षित र व्यावसायिक क्याडेट दर्ता प्रणालीमा तपाईँलाई
                हार्दिक स्वागत छ।</p>
            <div class="card-spinner" aria-hidden="true"></div>
        </div>
    </div>

    <!-- NOTICE MODAL (document-style) -->
    <div id="noticeModal" class="hidden modal-overlay" aria-hidden="true">
        <div class="modal-container">
            <div class="modal-content notice-doc" role="dialog" aria-labelledby="noticeTitle">
                <button class="modal-close" id="closeNotice" aria-label="close">✕</button>

                <header style="text-align:center; margin-bottom: 2cm;">
                    <img src="assets/photos/logo.png" alt="NCCAA logo"
                        style="width:55px; height:55px; object-fit:contain; display:block; margin: 0 auto 8px;" />
                    <div style="font-weight:700; font-size:16px; line-height:1.5; margin-bottom:2px;">एन.सि.सि अल्मुनाई
                        एशोसियशन नेपाल</div>
                    <div style="font-weight:500; font-size:14px; color:#374151;">लुम्बिनी प्रदेश</div>
                </header>

                <div style="display:flex; justify-content:space-between; margin-bottom:1.5cm;">
                    <div style="color:#374151;">
                        <div style="margin-bottom:4px;">पत्र संख्या: ५२/५३</div>
                        <div>चलानी नं:</div>
                    </div>
                    <div style="color:#374151;">मिति: २०८२/०७/२७</div>
                </div>

                <div style="margin-bottom:1cm;">
                    <h3 id="noticeTitle" style="font-weight:600; text-align:center;">विषय: सूचना ।</h3>
                </div>

                <div style="font-size:14px; line-height:1.8; margin-bottom:24px; text-align:justify;">
                    एन.सि.सि. अल्मुनाई एशोसियशन लुम्बिनी प्रदेश समितिको कार्यतालिका अनुसार, प्रदेश कार्यसमितिको पुनर्गठन
                    कार्य शीघ्रै सञ्चालन हुने व्यहोरा सम्बन्धित सबै क्याडेटहरूलाई सूचित गरिन्छ।
                </div>

                <div style="font-size:14px; line-height:1.8; margin-bottom:32px; text-align:justify;">
                    तसर्थ, उक्त समितिमा आवद्ध हुन इच्छुक तथा योग्य एन.सि.सि. क्याडेटहरूले तल उल्लेखित पदहरूको लागि आवेदन
                    दिन सक्ने हुन्।
                </div>

                <div style="margin-bottom:32px;">
                    <div style="font-weight:600; margin-bottom:12px;">उपलब्ध पदहरू:</div>
                    <div style="padding-left:32px;">
                        <div style="margin-bottom:6px;">निर्देशक (Director) — १ जना</div>
                        <div style="margin-bottom:6px;">सह–निर्देशक (Co-Director) — १ जना</div>
                        <div style="margin-bottom:6px;">सदस्य (Members) — १३ जना</div>
                        <div style="margin-top:12px;">कुल पद संख्या: १५ जना</div>
                    </div>
                </div>

                <div style="margin-bottom:32px;">
                    <div style="margin-bottom:8px;">जानकारीका लागि सम्पर्क:</div>
                    <div style="padding-left:32px;">
                        <div style="margin-bottom:4px;">इमेल: nccaalumbini@gmail.com</div>
                        <div>WhatsApp: +977 9769307983</div>
                    </div>
                </div>

                <div style="display:flex; justify-content:flex-end; margin-bottom:32px; margin-top:48px;">
                    <div style="text-align:right;">
                        <div style="font-weight:600; margin-bottom:4px;">सचिवालय</div>
                        <div style="margin-bottom:2px;">एन.सि.सि अल्मुनाई एशोसियशन नेपाल</div>
                        <div>लुम्बिनी प्रदेश</div>
                    </div>
                </div>

                <button id="goToForm" class="btn-primary notice-cta" style="margin-top:4px;">आवेदन फारममा
                    जानुहोस्</button>
            </div>
        </div>

        <!-- APPLICATION FORM -->
        <div id="applicationForm" class="hidden form-container">
            <h1 class="form-title">मनोनयन आवेदन फारम</h1>

            <div class="form-field">
                <label for="serialNo">व्य.नं.</label>
                <input type="text" id="serialNo" placeholder="............................" required />
            </div>

            <div class="form-field">
                <label for="rank">दर्जा :</label>
                <input type="text" id="rank" placeholder="............................" required />
            </div>

            <div class="form-field">
                <label for="name">नामथर:</label>
                <input type="text" id="name" placeholder="............................" required />
            </div>

            <div class="form-field">
                <label for="age">उमेर :</label>
                <input type="number" id="age" placeholder="............................" required />
            </div>

            <div class="form-field">
                <label for="gender">लिङ्ग :</label>
                <select id="gender" required>
                    <option value="">............................</option>
                    <option value="पुरुष">पुरुष</option>
                    <option value="महिला">महिला</option>
                    <option value="अन्य">अन्य</option>
                </select>
            </div>

            <div class="form-field">
                <label for="contact">सम्पर्क नं.</label>
                <input type="text" id="contact" placeholder="............................" required />
            </div>

            <div class="form-field">
                <label for="email">इमेल :</label>
                <input type="email" id="email" placeholder="............................" required />
            </div>

            <div class="form-field">
                <label for="address">ठेगाना :</label>
                <input type="text" id="address" placeholder="..........................................." required />
            </div>

            <div class="form-field">
                <label for="schoolName">दीक्षित विद्यालयको नाम :</label>
                <input type="text" id="schoolName" placeholder="..........................................." required />
            </div>

            <button id="submitForm" class="form-submit">आवेदन पेश गर्नुहोस्</button>
        </div>

        <!-- SUCCESS MESSAGE -->
        <div id="successMessage" class="hidden modal-overlay">
            <div class="success-modal">
                <div class="success-icon">✅</div>
                <div class="success-text">तपाईंको आवेदन सफलतापूर्वक सुरक्षित गरिएको छ।</div>
                <div class="success-text">धन्यवाद!</div>
                <button id="backToHome" class="success-btn">पुनः सुरु गर्नुहोस्</button>
            </div>
        </div>

        <script>
            // Show loading screen for 5 seconds, then fade out and show notice
            setTimeout(() => {
                const loading = document.getElementById('loadingScreen');
                // add fade-out class for smooth transition, then hide completely
                loading.classList.add('fade-out');
                setTimeout(() => {
                    loading.classList.add('hidden');
                    loading.classList.remove('fade-out');
                    document.getElementById('noticeModal').classList.remove('hidden');
                }, 650);
            }, 5000);

            // Close notice
            document.getElementById('closeNotice').addEventListener('click', () => {
                document.getElementById('noticeModal').classList.add('hidden');
            });

            // Go to form
            document.getElementById('goToForm').addEventListener('click', () => {
                document.getElementById('noticeModal').classList.add('hidden');
                document.getElementById('applicationForm').classList.remove('hidden');
            });

            // Submit form
            document.getElementById('submitForm').addEventListener('click', async () => {
                const { jsPDF } = window.jspdf;

                // Get form data
                const formData = {
                    serialNo: document.getElementById('serialNo').value.trim(),
                    rank: document.getElementById('rank').value.trim(),
                    name: document.getElementById('name').value.trim(),
                    age: document.getElementById('age').value.trim(),
                    gender: document.getElementById('gender').value.trim(),
                    contact: document.getElementById('contact').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    schoolName: document.getElementById('schoolName').value.trim()
                };

                // Validate
                for (let key in formData) {
                    if (!formData[key]) {
                        alert(`कृपया ${key} भर्नुहोस्`);
                        return;
                    }
                }

                // Generate PDF matching your template exactly
                const doc = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                // Set font size for consistency
                doc.setFontSize(12);

                // Title
                doc.text('मनोनयन आवेदन फारम', 105, 20, { align: 'center' });

                // Date (top right)
                doc.setFontSize(10);
                doc.text('मिति: २०८२/०७/२७ / गते', 170, 30, { align: 'right' });

                // Address (top left)
                doc.setFontSize(10);
                doc.text('श्रीमान् पूतनापति ज्यू,', 20, 40);
                doc.text('श्री मध्य पश्चिम पूतना मुख्यालय,', 20, 45);
                doc.text('योगकुटी ब्यारेक, रुपन्देही, नेपाल ।', 20, 50);

                // Subject line
                doc.setFontSize(12);
                doc.text('विषय: एन.सि.सि अल्मुनाई एशोसिएशन नेपाल लुम्बिनी प्रदेश ......................... पदमा मनोनयन गरिदिनु हुन।', 20, 65);

                // Body paragraph (exact match)
                doc.setFontSize(10);
                const bodyText = 'श्री राष्ट्रिय सेवा दलको ................... औं ब्याच ................... डिभिजन तालिमबाट दीक्षित, अनुशासित, ईमानदार, कर्तव्यनिष्ठ, नेतृत्वकारी र राष्ट्रियताको भावनाले प्रेरित भई विगत ................... सालबाट समाज सेवा/स्वयंसेवकको रूपमा ................... जिल्ला/क्षेत्रमा सक्रिय रहेको, सबैसँग समन्वय गरी संगठनलाई परेको समयमा योगदान दिन सक्ने र कुनै पनि राजनैतिक दलसंग आवद्ध नभएको तथा एन.सि.सि अल्मुनाई एशोसिएशनको विधान अनुसार योग्य र अनुभवी पूर्व एन.सि.सि. क्याडेट भएको हुनाले प्रदेश स्तरमा रहेको एन.सि.सि. अल्मुनाई एशोसियशन नेपालको लुम्बिनी प्रदेश ................... पदमा मनोनयनको लागि स्वईच्छाले यो आवेदन पेश गरेको छु ।';
                doc.text(bodyText, 20, 80, { maxWidth: 170 });

                // Fields (exact layout)
                let y = 120;
                const lineHeight = 10;

                doc.setFontSize(10);
                doc.text(`व्य.नं. : ${formData.serialNo}`, 20, y); y += lineHeight;
                doc.text(`दर्जा : ${formData.rank}`, 20, y); y += lineHeight;
                doc.text(`नामथर: ${formData.name}`, 20, y); y += lineHeight;
                doc.text(`उमेर : ${formData.age}`, 20, y); y += lineHeight;
                doc.text(`लिङ्ग : ${formData.gender}`, 20, y); y += lineHeight;
                doc.text(`सम्पर्क नं. : ${formData.contact}`, 20, y); y += lineHeight;
                doc.text(`इमेल : ${formData.email}`, 20, y); y += lineHeight;
                doc.text(`ठेगाना : ${formData.address}`, 20, y); y += lineHeight;
                doc.text(`दीक्षित विद्यालयको नाम : ${formData.schoolName}`, 20, y); y += lineHeight;

                // Signature line
                doc.setFontSize(12);
                doc.text('आवेदकको दस्तखत', 170, y + 20, { align: 'right' });

                // Generate filename: "name_form.pdf"
                const fileName = `${formData.name.replace(/\s+/g, '_')}_form.pdf`;

                // Convert PDF to Blob
                const pdfBlob = doc.output('blob');

                // Upload to Google Drive
                await uploadToGoogleDrive(formData, pdfBlob, fileName);

                // Show success
                document.getElementById('applicationForm').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');
            });

            // Back to home
            document.getElementById('backToHome').addEventListener('click', () => {
                document.getElementById('successMessage').classList.add('hidden');
                document.getElementById('noticeModal').classList.remove('hidden');
            });

            // Google Drive Upload Function
            async function uploadToGoogleDrive(formData, pdfBlob, fileName) {
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const base64String = reader.result.split(',')[1];

                    try {
                        const response = await fetch('https://script.google.com/macros/s/AKfycbxrXlsusu7Bc21QeehMuJ7cvGFUaYuZ5LDRTNPzDGG5hyvh7C-QLI9MqV3o8NL5iYVpmQ/exec', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                formData: formData,
                                pdfBase64: base64String,
                                fileName: fileName
                            })
                        });

                        const result = await response.json();
                        if (!result.success) {
                            throw new Error(result.error || 'Upload failed');
                        }

                    } catch (error) {
                        alert('अपलोडमा समस्या भयो। कृपया फेरि प्रयास गर्नुहोस्।');
                        console.error('Upload error:', error);
                    }
                };
                reader.readAsDataURL(pdfBlob);
            }
        </script>

</body>

</html>